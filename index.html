<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>родрооро┐ро┤рпНроХрпН роХро│роЮрпНроЪро┐ропроорпН роЖро┤рпНроиро┐ро▓рпИроХрпН роХро▒рпНро▒ро▓рпНроорпБро▒рпИ ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Noto Sans Tamil', sans-serif;
    margin: 0;
    background: #f5f7fb;
    color: #222;
    /* роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ ро╡ро┐ройро╛роХрпНроХро│рпИ рооро▒рпИрокрпНрокродрпИродрпН родро╡ро┐ро░рпНроХрпНроХ роЗроЯрпИро╡рпЖро│ро┐ */
    padding-bottom: 60px; 
  }
  .hidden { display: none !important; }
  
  /* Login & Dashboard Styles (Unchanged for brevity, kept your logic) */
  #login-container { max-width: 500px; margin: 100px auto; padding: 30px; background: #fff; border-radius: 10px; box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08); text-align: center; }
  #username-input { width: 90%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; margin-top: 10px; }
  #login-btn { padding: 12px 25px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; color: #fff; background: #28a745; margin-top: 20px; }
  
  #dashboard-container { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08); }
  #dashboard-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
  
  .header { display: flex; align-items: center; justify-content: space-between; background: linear-gradient(90deg, #007bff, #00b894); color: white; padding: 12px 20px; border-bottom: 4px solid #0a58ca; }
  .header img { width: 80px; height: 80px; border-radius: 50%; background: white; object-fit: cover; }

  /* Quiz Layout */
  #tv-quiz-wrap { max-width: 1000px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08); display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
  @media (max-width: 900px) { #tv-quiz-wrap { grid-template-columns: 1fr; } }

  #tv-progress { text-align: center; font-weight: 700; background: #eef4ff; padding: 8px; border-radius: 6px; margin-bottom: 12px; }
  #tv-question { font-size: 1.15rem; font-weight: 700; margin-bottom: 12px; }
  #tv-options { display: flex; flex-direction: column; gap: 10px; }
  .option-btn { padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; text-align: left; cursor: pointer; font-size: 1rem; }
  .option-btn.correct { background: #e6f7e9; border-color: #28a745; }
  .option-btn.wrong { background: #fdecea; border-color: #dc3545; }
  
  #tv-feedback { display: none; margin-top: 14px; padding: 12px; background: #fdfdfd; border: 1px dashed #bbb; border-radius: 8px; }

  /* Side Panel & Timer */
  #tv-side { background: #f5fcf8; border-radius: 10px; padding: 15px; border: 1px solid #cce5d3; }
  #tv-timer-box { text-align: center; border: 2px solid #dc3545; border-radius: 8px; padding: 10px; margin-top: 15px; }
  #tv-timer-display { font-size: 2rem; font-weight: 700; color: #333; }
  #tv-timer-display.warning { color: #dc3545; animation: pulse 1s infinite; }

  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

  /* Results */
  #tv-results { display: none; text-align: center; padding: 20px; border-top: 2px solid #28a745; }
</style>
</head>
<body>

  <div id="login-container">
    <h2>ЁЯСЛ ро╡рогроХрпНроХроорпН!ЁЯУЪ</h2>
    <p>ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родрпКроЯроЩрпНроХрпБроорпН роорпБройрпН, роЙроЩрпНроХро│рпН рокрпЖропро░рпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.</p>
    <input type="text" id="username-input" placeholder="роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН">
    <button id="login-btn">роЙро│рпНроирпБро┤рпИ</button>
  </div>

  <main id="app-container" class="hidden">
    <div class="header">
      <img src="images/родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН.jpg" alt="родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН">
      <div style="text-align:center">
        <h1>родрооро┐ро┤рпНроХрпН роХро│роЮрпНроЪро┐ропроорпН роЖро┤рпНроиро┐ро▓рпИроХрпН роХро▒рпНро▒ро▓рпНроорпБро▒рпИ ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</h1>
        <p>ЁЯУЪ роЙроЩрпНроХро│рпН роЕро▒ро┐ро╡рпИроЪрпН роЪрпЛродро┐родрпНродрпБ роорпЗроорпНрокроЯрпБродрпНродро┐роХрпН роХрпКро│рпНро│рпБроЩрпНроХро│рпН ЁЯУЪ</p>
      </div>
      <img src="images/родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН.jpg" alt="родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН">
    </div>

    <div id="dashboard-container">
      <div id="dashboard-header">
        <h2 id="welcome-message">ЁЯУИ роОройрпН роХро▒рпНро▒ро▓рпН рокродро┐ро╡рпБроХро│рпН</h2>
        <button id="logout-btn">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
      </div>
      <div id="dashboard-stats" style="display:flex; gap:10px; margin-bottom:15px;">
        <div style="flex:1; background:#f4f4f4; padding:10px; border-radius:8px; text-align:center;">
          <h4>роорпКродрпНрод роорпБропро▒рпНроЪро┐роХро│рпН</h4>
          <p id="stat-total-attempts" style="font-size:1.5rem; font-weight:bold; color:#007bff;">0</p>
        </div>
        <div style="flex:1; background:#f4f4f4; padding:10px; border-radius:8px; text-align:center;">
          <h4>роЪро░ро╛роЪро░ро┐ роородро┐рокрпНрокрпЖрогрпН</h4>
          <p id="stat-avg-score" style="font-size:1.5rem; font-weight:bold; color:#007bff;">0%</p>
        </div>
      </div>
      <div id="dashboard-history" style="max-height:200px; overflow-y:auto;">
        <table id="history-table">
          <thead><tr><th>родрпЗродро┐</th><th>родро▓рпИрокрпНрокрпБ</th><th>роородро┐рокрпНрокрпЖрогрпН</th></tr></thead>
          <tbody id="history-table-body"></tbody>
        </table>
        <p id="no-history-msg" style="text-align:center; display:none;">роЗройрпНройрпБроорпН рокропро┐ро▒рпНроЪро┐роХро│рпН роЗро▓рпНро▓рпИ.</p>
      </div>
    </div>

    <div id="tv-quiz-wrap">
      <div id="tv-main">
        <select id="quizSelect">
          <option value="" disabled selected>ЁЯза ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛ родрпКроХрпБрокрпНрокрпИродрпН родрпЖро░ро┐ро╡рпБроЪрпЖропрпНроХ</option>
        </select>
        
        <div id="quiz-area">
            <div id="tv-progress"></div>
            <div id="tv-question"></div>
            <div id="tv-options"></div>
            <div id="tv-feedback"></div>
            <div class="quiz-nav" style="display:flex; justify-content:space-between; margin-top:15px;">
              <button id="tv-prev" style="display:none; background:#ff9800; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer;">ЁЯСИ роорпБроирпНродрпИроп</button>
              <button id="tv-next" style="display:none; background:#007bff; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer;">роЕроЯрпБродрпНродродрпБ ЁЯСЙ</button>
            </div>
        </div>

        <div id="tv-results">
          <h2 id="tv-result-title">ЁЯОЙ ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН! ЁЯОЙ</h2>
          <p id="tv-result-score"></p>
          <p id="tv-result-percentage"></p>
          <p id="tv-result-message" style="background:#f4f4f4; padding:10px; border-radius:8px; font-style:italic;"></p>
          <button id="tv-restart-btn" style="margin-top:20px; padding:10px 20px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer;">рооро▒рпБрокроЯро┐ропрпБроорпН ро╡ро┐ро│рпИропро╛роЯрпБ ЁЯФБ</button>
        </div>
      </div>

      <div id="tv-side">
        <div id="tv-participants-box">
          <h3>ЁЯСд рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН</h3>
          <div id="tv-total-participants" style="font-size: 2rem; font-weight: 700; color: #28a745;">0</div>
        </div>
        <div id="tv-timer-box" style="display:none;">
          <h3>тП░ роОроЮрпНроЪро┐роп роирпЗро░роорпН</h3>
          <div id="tv-timer-display">00:00</div>
        </div>
        <div style="margin-top:20px; border-top:1px solid #ddd; padding-top:10px;">
            <h4>ЁЯСитАНЁЯТ╗ роЙро░рпБро╡ро╛роХрпНроХрпБроиро░рпН</h4>
            <p style="font-size:0.85rem">роорпБройрпИро╡ро░рпН роЪродрпНродро┐ропро░ро╛роЪрпБ родроЩрпНроХроЪрпНроЪро╛рооро┐<br>родрооро┐ро┤рпНроиро╛роЯрпБ, роЗроирпНродро┐ропро╛</p>
        </div>
      </div>
    </div>
  </main>

  <script src="js/quiz-loader.js"></script>
  <script src="js/footer-history.js"></script>

  <script>
    // --- ЁЯСС роХрпБро▒ро┐ропрпАроЯрпБ рооро▒рпНро▒рпБроорпН родро░рпНроХрпНроХроЩрпНроХро│рпН ЁЯСС ---
    let inactivityTimer;
    const INACTIVITY_MINUTES = 4;
    let timerInterval;
    let totalSeconds;

    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    const loginBtn = document.getElementById('login-btn');
    const usernameInput = document.getElementById('username-input');
    const logoutBtn = document.getElementById('logout-btn');
    
    // --- ЁЯСС Reset Inactivity Timer ЁЯСС ---
    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        alert(`роирпАроЩрпНроХро│рпН ${INACTIVITY_MINUTES} роиро┐рооро┐роЯроЩрпНроХро│ро╛роХроЪрпН роЪрпЖропро▓рпНрокроЯро╡ро┐ро▓рпНро▓рпИ. ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роорпБроЯро┐роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.`);
        if (typeof showResults === 'function') showResults();
      }, INACTIVITY_MINUTES * 60 * 1000);
    }

    function stopInactivityTimer() { clearTimeout(inactivityTimer); }

    // --- ЁЯСС Timer Logic ЁЯСС ---
    function calculateMinutes(count) {
      if (count <= 25) return count;
      if (count <= 100) return 90;
      return Math.round(count * 0.9);
    }

    function startQuizTimer(questionCount) {
      stopTimer();
      resetInactivityTimer();
      const timerBox = document.getElementById('tv-timer-box');
      totalSeconds = calculateMinutes(questionCount) * 60;
      timerBox.style.display = 'block';
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        totalSeconds--;
        updateTimerDisplay();
        if (totalSeconds <= 0) {
          stopTimer();
          alert('роирпЗро░роорпН роорпБроЯро┐роирпНродродрпБ!');
          if (typeof showResults === 'function') showResults();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const display = document.getElementById('tv-timer-display');
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      display.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      display.classList.toggle('warning', totalSeconds <= 60);
    }

    function stopTimer() { clearInterval(timerInterval); }

    // --- ЁЯСС Results Logic ЁЯСС ---
    function showCustomResults(score, total, title) {
      stopTimer();
      stopInactivityTimer();
      document.getElementById('tv-timer-box').style.display = 'none';
      document.getElementById('quiz-area').style.display = 'none';
      
      const resContainer = document.getElementById('tv-results');
      resContainer.style.display = 'block';
      
      const pct = total > 0 ? Math.round((score / total) * 100) : 0;
      document.getElementById('tv-result-score').textContent = `роородро┐рокрпНрокрпЖрогрпН: ${score} / ${total}`;
      document.getElementById('tv-result-percentage').textContent = `ро╡ро┐ро┤рпБроХрпНроХро╛роЯрпБ: ${pct}%`;
      
      let msg = "";
      if (pct === 100) msg = "ЁЯТп роЕро░рпБроорпИ! роорпБро┤рпБ ро╡рпЖро▒рпНро▒ро┐!";
      else if (pct >= 80) msg = "ЁЯМЯ рооро┐роХроЪрпН роЪро┐ро▒рокрпНрокрпБ! родрпКроЯро░роЯрпНроЯрпБроорпН роЙроЩрпНроХро│рпН рокрогро┐.";
      else if (pct >= 50) msg = "ЁЯСН роиро▓рпНро▓ роорпБропро▒рпНроЪро┐! роЗройрпНройрпБроорпН роХрпКроЮрпНроЪроорпН рокропро┐ро▒рпНроЪро┐ родрпЗро╡рпИ.";
      else msg = "ЁЯТк ро╡ро┐роЯро╛роорпБропро▒рпНроЪро┐ роЪро┐ро▒роирпНрод ро╡рпЖро▒рпНро▒ро┐! роорпАрогрпНроЯрпБроорпН роорпБропро▓ро╡рпБроорпН.";
      
      document.getElementById('tv-result-message').textContent = msg;
      saveQuizResult(title, score, total, pct);
    }

    // --- ЁЯСС Data Persistence ЁЯСС ---
    function checkLogin() {
      const user = localStorage.getItem('quizUser');
      user ? showApp() : showLogin();
    }

    function showLogin() {
      loginContainer.classList.remove('hidden');
      appContainer.classList.add('hidden');
    }

    function showApp() {
      loginContainer.classList.add('hidden');
      appContainer.classList.remove('hidden');
      const user = JSON.parse(localStorage.getItem('quizUser'));
      document.getElementById('welcome-message').textContent = `ЁЯУИ роОройрпН роХро▒рпНро▒ро▓рпН рокродро┐ро╡рпБроХро│рпН (ро╡рогроХрпНроХроорпН, ${user.name}!)`;
      loadDashboardData(user.name);
    }

    function saveQuizResult(title, score, total, pct) {
      const user = JSON.parse(localStorage.getItem('quizUser')).name;
      let history = JSON.parse(localStorage.getItem('quizHistory_' + user)) || [];
      history.unshift({ title, score, total, pct, date: new Date().toLocaleString('ta-IN') });
      localStorage.setItem('quizHistory_' + user, JSON.stringify(history));

      let all = JSON.parse(localStorage.getItem('allUserAttempts')) || {};
      all[user] = (all[user] || 0) + 1;
      localStorage.setItem('allUserAttempts', JSON.stringify(all));
      loadDashboardData(user);
    }

    function loadDashboardData(user) {
      const history = JSON.parse(localStorage.getItem('quizHistory_' + user)) || [];
      const tbody = document.getElementById('history-table-body');
      tbody.innerHTML = "";
      
      if (history.length === 0) {
        document.getElementById('no-history-msg').style.display = "block";
      } else {
        document.getElementById('no-history-msg').style.display = "none";
        let totalPct = 0;
        history.forEach(item => {
          const row = `<tr><td>${item.date}</td><td>${item.title}</td><td>${item.score}/${item.total} (${item.pct}%)</td></tr>`;
          tbody.innerHTML += row;
          totalPct += item.pct;
        });
        document.getElementById('stat-total-attempts').textContent = history.length;
        document.getElementById('stat-avg-score').textContent = Math.round(totalPct / history.length) + "%";
      }

      const all = JSON.parse(localStorage.getItem('allUserAttempts')) || {};
      const lb = document.getElementById('leaderboard-table-body');
      lb.innerHTML = "";
      Object.entries(all).sort((a,b) => b[1]-a[1]).forEach(([name, count]) => {
        lb.innerHTML += `<tr><td>${name}</td><td>${count}</td></tr>`;
      });
      document.getElementById('tv-total-participants').textContent = Object.keys(all).length;
    }

    // --- ЁЯСС Event Listeners ЁЯСС ---
    loginBtn.addEventListener('click', () => {
      const name = usernameInput.value.trim();
      if (!name) return alert("рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН!");
      localStorage.setItem('quizUser', JSON.stringify({ name }));
      showApp();
    });

    logoutBtn.addEventListener('click', () => {
      if (confirm("ро╡рпЖро│ро┐ропрпЗро▒ ро╡рпЗрогрпНроЯрпБрооро╛?")) {
        localStorage.removeItem('quizUser');
        window.location.reload();
      }
    });

    document.getElementById('tv-restart-btn').addEventListener('click', () => {
        document.getElementById('tv-results').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'block';
        document.getElementById('quizSelect').selectedIndex = 0;
        document.getElementById('tv-progress').textContent = "";
        document.getElementById('tv-question').textContent = "";
        document.getElementById('tv-options').innerHTML = "";
    });

    document.addEventListener('DOMContentLoaded', checkLogin);
  </script>
</body>
</html>
